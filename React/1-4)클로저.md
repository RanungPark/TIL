# 1. 리액트 개발을 위해 꼭 알아야하는 자바스크립트(1-4)

## 1-4 클로저

### 클로저의 정의

MDN에서는 클로저는 함수와 함수가 선언된 어휘적 환경의 조합이라고 명시되어있다

이에 어휘적 환경이란 변수가 코드 내부에서 어디서 선언됐는지를 말하는 것이다

```jsx
function add() {
	const a = 10
	function innerAdd() {
		const b = 20
		console.log(a+b)
	}
	innerAdd()
}
add()
```

a는 add에 선언되었지만 innerAdd에서 b와 같이 연산되었다. 이는 호출되는 방식에 따라 동적으로 결정되는 this와는 다르게 작성되는 순간 정적으로 결정된다. 클로저는 이러한 어휘적 환경을 조합해 코딩하는 기법이다.

### 변수의 유효 범위, 스코프

변수의 유효한 범위를 스코프라고 한다.

**전역 스코프**

전역 레벨에 선언하는 것을 전역 스코프라고 한다.

이 스코프에서 변수를 선언하면 어디서든 호출할 수 있게 된다.

브라우저 환경에서 전역객체는 window, Node.js환경은  global이 있는데 이 객체에 전역 레벨에 선언한 스코프가 바인딩된다.

**함수 스코프**

자바스크립트는 함수 레벨 스코프를 따른다.

즉 {} 블록이 스코프 범위를 결정하지 않는다.

자바스크립트 스코프는 가장 가까운 스코프에 변수가 존재하는지 먼저 확인해본다

### **클로저의 활용**

**클로저의 활용**

변수를 전역에서 사용한다면 누구나 수정할 수 있다는 큰 문제가 존재한다

이를 해결할 때 클로저를 활용한다 

```jsx
function Counter() {
	var counter = 0

	return {
		increase: function () {
			return ++counter
		},
		decrease: function () {
			return --counter
		},
		counter: function () {
			console.log('counter에 접근!')
			return counter
		},
	}
}

var c = Counter ()

console.log(c.increase()) //1
console.log(c.increase()) //2
console.log(c.increase()) //3
console.log(c.decrease()) //2
console.log(c.counter()) //2
```

이러한 클로저를 활용했을때 얻는 이점은 여러가지가 있다.

먼저 counter변수를 직접적으로 노출하지 않음으로써 사용자가 직접 수정하는 것을 막았음은 물론, 접근하는 경우를 제한해 로그를 남기는 등의 부차적인 작업도 수행할 수 있게 된다.

counter 변수의 업데이트를 increase, decrease로 제한해 무분별하게 변경되는 것을 막을 수 있다.

즉 클로저를 활용하면 전역 스코프의 사용을 막고, 개발자가 원하는 정보만 개발자가 원하는 방향으로 노출시킬 수 있다는 장점이 있다.

**리액트에서의 클로저**

리액트에서 클로저의 원리를 사용하고 있는 대표적인 것 중 하나가 바로 useState이다.

setState는 어떻게 useState내부의 최신 정보를 확인할 수 있는가는 useState내부가 클로저로 활용되었기 때문이다

외부 함수가 반환한 내부 함수는 외부 함수의 호출이 끝났음에도 자신이 선언된 외부 함수가 선언된 환경을 기억하기 때문이다 이때 외부 함수는 setState이고 내부는 useState이다.

**주의할 점**

for속 i를 var로 선언시 자바스크립트는 함수 레벨 스코프이므로 i는 전역에 속한다 이를 해결하기 위해서는 let을 이용하여 블록 레벨 스코프를 사용하거나 클로저를 제대로 활용하는 것이다

클로저는 제대로 활용하기 매우 어렵다

클로저를 사용할 때 주의해야 할 점은 클로저를 사용하는데 비용이 든다는 것이다

클로저는 생성될 때마다 그 선언적 환경를 기억해야 하므로 추가로 비용이 발생한다.

길이가 매우 긴 배열을 처리할때 일반 함수를 사용하면 처음 실행시간이 조금 길지만 클릭과 동시에 선언되지만 클로저를 활용한다면 언제 어디서 사용될지 모를 변수들을 메모리에 선언된 순간 저장한다. 이로 인해 클로저가 성능에 영향을 줄 수 있다.

### 정리

클로저는 함수형 프로그래밍의 중요한 개념, 부수 효과가 없고 순수해야 한다는 목적을 달성하기 위해 적극적으로 사용되는 개념이다. 그러나 클로저는 공짜로 쓸 수 있는 것이 아니다. 클로저를 사용하기에 앞서 항상 중의를 기울여야 한다.
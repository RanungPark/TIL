# 1. 리액트 개발을 위해 꼭 알아야하는 자바스크립트(1-5)

## 1-5 이벤트 루프와 비동기 통신의 이해

자바스크립트는 싱글스레드에서 작동한다. 자바스크립트는 한 번에 하나의 작업만 동기 방식으로만 처리할 수 있다.

동기란 간단하게 직렬 방식으로 처리하는 것을 의미하며, 이 요청이 시작된 이후에는 무조건 응답을 받은 이후에야 비로소 다른 작업을 처리한다.

비동기란 직렬 방식이 아니라 병렬 방식으로 작업을 처리하는 것을 의미한다. 요청이 시작한 후 이 응답이 오건 말건 상관없이 다음 작업이 이루어지며 따라서 한 번에 여러 작업이 실행될 수 있다.

비동기 작업이 어떻게 처리되는지 이해하고 비동기 처리를 도와주는 이벤트 루프를 비롯한 다양한 개념에 대해 알고 있어야 한다. 비동기 코드의 작동방식에 대해 이해한다면 **자바스크립트에 어떻게 여러 가지 요청을 동시에 처리하고 있는지**, **이러한 요청받은 테스크에 대한 우선순위는 무엇인지**, 또 **주의할 점은 무엇인지** 파악해 사용자에게 더욱 매끄러운 웹 애플리케이션 서비스를 제공할 수 있을 것이다.

### 싱글 스레드 자바스크립트

과거 프로그램을 실행하는 단위가 오직 프로세스뿐이었다.

프로세스란 프로그램을 구동해 프로그램의 상태가 메모리상에서 실행되는 작업 단위를 의미한다.

하나의 프로세스에 여러 개의 스레드를 만들 수 있고, 스레드끼니는 메모리를 공유할 수 있어 여러 가지 작업을 동시에 수행할 수 있다. 이에 따라 프로세스 내부에서 여러 개의 스레드를 활용하면 동시 다발적인 작업을 처리할 수 있다

멀티스레드의 

- 단점: 내부적으로 처리가 복잡하다는 점
    - 스레드는 하나의 프로세스에서 동시에 서로 같은 자원에 접근할 수 있다
        - 동시에 여러 작업을 수행하다 보면 같은 자원에 대해 여러 번 수정하는 등 동싯ㅇ 문제가 발생할 수 있어 이에 대한 처리가 필요하다
    - 각각 격리돼 있는 프로세스와 다르게 하나의 스레드가 문제가 생기면 같은 자원을 고유하는 다른 스레드에도 동시에 문제가 일어난다
- 장점: 여러 가지 작업을 동시에 수행할 수 있는점

**자바스크립트가 싱글스레드인 이유**

30년전에는 이정도의 다양한 일을 헐 것이라 예상을 못하였음

DOM을 여러 스레드가 조작한다면 메모리 공유로 인해 동시에 같은 자원에 접근하면 타이밍 이슈가 발생하고 이는 브라우저의 DOM 표시에 큰 문제를 야기할 수 있다

**자바스크립트가 싱글스레드임을 의미하는것**

- 자바스크립트 코드의 실행이 하나의 스레드에서 순차적으로 이루어진다는 것
- 하나의 스레드에서 순차적으로 이루어진다는 것은 코드를 한 줄 한 줄 실행한다는 것
- 궁국적으로 하나의 작업이 끝나기 전까지 뒤이은 작업이 실행되지 않는다는 것

async를 이용하면 비동기로 작성할 수 있다.

### 이벤트 루프란?

이벤트 루프란 자바스크립트 표준에 나온 내용이 아닌 자바스크립트 런타임 외부에서 자바스크립트의 비동기 실행을 돕기 위해 만들어진 장치라고 볼 수 있다.

**호출 스택과 이벤트 루프**

호출 스택이 비어 있는지 여부를 확인하는 것이 바로 이벤트 루프이다.

태스크 큐란 실행해야 할 태스크의 집합을 의미한다.

태스크 큐는 set 형태를 띠고 있다 태스크큐에서 의미하는 실행해야 할 태스크라는 것은 비동기 함수의 콜백함수나 이벤트 핸들러 등을 의미한다.

즉 이벤트 루프의 역할은 스택에 실행 중인 코드가 있는지, 그리고 태스크 큐에 대기 중인 함수가 있는지 반복해서 확인하는 역할을 한다.

- 호출 스택이 비었다면 태스크 큐에 대기 중인 작업이 있는지 확인
- 태스크 큐 작업에 들어있는 실행한 오래된 것부터 순차적으로 꺼내와서 실행
- 태스크 큐가 빌 때 까지 이루어짐

setTimeout, fetch를 기반으로 생행되는 네트워크 요청등 이러한 작업들은 모두 자바스크립트 코드가 동기식으로 실행되는 메인 스레드가 아닌 태스크 큐가 할당되는 별도의 스레드에서 수행된다.

이러한 작업은 자바스크립트 코드가 실행하는 것이 아닌 외부 Web API(브라우저, Node.js)등이 실행해 주는 것이다.

### 태스크 큐와 마이크로 태스크 큐

마이크로 태스크 큐는 기존 태스크 큐와 다른 태스크를 처리한다.

여기에 들어가는 마이크로 태스크에는 대표적으로 Promise가 있다

마이크로 태스크 큐가 빌 때까지는 기존 태스크 큐의 실행은 뒤로 미룬다

마이크로 태스크 큐를 실행한 뒤 렌더링이 일어난다

순서

이벤트 루프 시작 →호출 스택 → 비워지면 → 마이크로 태스크 큐 → 비워지면 → 렌더링 → 태스크 큐 → 비워지면 → 이벤트 루프 종료

동기 코드는 물론 마이크로 태스크 또한 마찬가리로 렌더링에 영향을 미칠 수 있다. 따라서 특정 렌더링이 자바스크립트 내 무거운 작업과 연관이 있다면 이를 어떤 식으로 분리해서 사용자에게 좋은 애플리케이션 경험을 제공해 줄지 고민해 보아야 한다.

### 정리

자바스크립트 코드를 실행하는 것 자체는 싱글 스레드 이루어져서 비동기를 처리하기 어렵지만 자바스크립트 코드를 실행하는 것 이외에 태스트 큐, 이벤트 루프, 마이크로 태스트큐, 브라우저/Node.js API등이 적절한 생태계를 이루고 있기 때문에 싱글 스레드로는 불가능한 비동기 이벤트 처리가 가능해진다.